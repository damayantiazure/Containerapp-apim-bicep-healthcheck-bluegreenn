# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none
#- master

pool:
  vmImage: ubuntu-latest
variables:
 resourceGroupName: "APIM-DEVOPS"
 location: "eastus"
 APP_NAME: "solar201"
 APP_ENV: "dev"  
 imageName: "ComplianceWebApi"
 tag: "$(Build.BuildId)"
 registry: "${appname}contregistry${appEnv}.azurecr.io"
 imageRepository: "ComplianceWebApi"


steps:
# Create Core Infra stucture
# - task: AzureCLI@2
#   displayName: Create Core Infrastructure
#   inputs:
#     azureSubscription: 'masterconnection'
#     scriptType: 'bash'
#     scriptLocation: 'scriptPath'
#     scriptPath: 'Infrastructure/Platform/create-core-infra.sh'
- task: AzureCLI@2
  inputs:
    azureSubscription: 'masterconnection'
    scriptType: 'bash'
    scriptLocation: 'scriptPath'
    scriptPath: 'src/WebApis/ComplianceWebApi/builddocker.sh'
  env:
    imageName: $imageName
    tag: $tag
    registry: $registry

# - task: Docker@2
#   displayName: Build and push an image to container registry
#   inputs:
#     command: buildAndPush
#     repository: $(imageRepository)
#     dockerfile: $(dockerfilePath)
#     containerRegistry: $(dockerRegistryServiceConnection)
#     tags: |
#         $(tag)  
       



# Deploy Infra for Container app 


